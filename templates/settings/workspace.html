{% extends "base.html" %}

{% block title %}Workspace - Mina{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/toast-notifications.css') }}">
{% endblock %}

{% block content %}
<div class="container settings-container" data-user-id="{{ current_user.id }}">
    <div class="settings-header">
        <h1 class="settings-title">Settings</h1>
        <p class="settings-subtitle">Manage your account and preferences</p>
    </div>

    <div class="settings-tabs">
        <nav class="settings-tabs-nav">
            <a href="{{ url_for('settings.preferences') }}" class="tab-link">Preferences</a>
            <a href="{{ url_for('settings.integrations') }}" class="tab-link">Integrations</a>
            <a href="{{ url_for('settings.profile') }}" class="tab-link">Profile</a>
            <a href="{{ url_for('settings.workspace_management') }}" class="tab-link active">Workspace</a>
        </nav>
    </div>

    <div style="max-width: 1000px;">

    <div class="settings-card">
        <h2 class="settings-card-title">Workspace Details</h2>
        <form data-form="workspace">
            <div style="display: flex; flex-direction: column; gap: var(--space-4);">
                <div>
                    <label class="block text-sm font-medium mb-2">Workspace Name</label>
                    <input type="text" name="name" value="{{ workspace.name if workspace else 'My Workspace' }}" class="w-full p-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Workspace URL</label>
                    <input type="text" name="slug" value="{{ workspace.slug if workspace else 'my-workspace' }}.mina.app" class="w-full p-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800" readonly>
                    <p class="text-xs text-secondary mt-1">Your team's unique workspace identifier</p>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Industry</label>
                    <select name="industry" class="w-full p-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800">
                        <option>Technology</option>
                        <option>Finance</option>
                        <option>Healthcare</option>
                        <option>Education</option>
                        <option>Consulting</option>
                        <option>Marketing</option>
                        <option>Other</option>
                    </select>
                </div>
            </div>
            <div style="margin-top: var(--space-6);">
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>

    <div class="settings-card">
        <div class="flex justify-between items-center mb-4">
            <h2 class="settings-card-title" style="margin-bottom: 0;">Team Members</h2>
            <button class="btn btn-primary btn-sm" data-action="invite-member">Invite Member</button>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: var(--space-3);">
            {% if workspace_members and workspace_members|length > 0 %}
            {% for member in workspace_members %}
            <div class="member-row flex justify-between items-center p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition">
                <div class="flex items-center gap-3">
                    <div class="avatar" style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--color-primary) 0%, #9333ea 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                        {{ (member.email[0] if member.email else member.username[0] if member.username else 'U')|upper }}
                    </div>
                    <div>
                        <p class="font-medium">{{ member.email or member.username }}</p>
                        <p class="text-sm text-secondary">{{ (member.role or 'member')|capitalize }}</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <select class="member-role-select p-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm" data-member-id="{{ member.id }}" data-original-value="{{ member.role or 'member' }}">
                        <option value="owner" {% if member.role == 'owner' %}selected{% endif %}>Owner</option>
                        <option value="admin" {% if member.role == 'admin' %}selected{% endif %}>Admin</option>
                        <option value="member" {% if member.role == 'member' or not member.role %}selected{% endif %}>Member</option>
                        <option value="viewer" {% if member.role == 'viewer' %}selected{% endif %}>Viewer</option>
                    </select>
                    {% if member.id != current_user.id %}
                    <button class="btn btn-sm btn-ghost" data-action="remove-member" data-member-id="{{ member.id }}" data-member-name="{{ member.email or member.username }}">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="text-center py-8">
                <p class="text-secondary">No team members yet</p>
                <button class="btn btn-primary btn-sm mt-4" data-action="invite-member">Invite your first member</button>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="settings-card">
        <h2 class="settings-card-title">Roles & Permissions</h2>
        <div style="display: flex; flex-direction: column; gap: var(--space-4);">
            <div style="padding: var(--space-4); border: 1px solid var(--color-border); border-radius: var(--radius-lg);">
                <h3 class="font-semibold mb-2">Owner</h3>
                <p class="text-sm text-secondary mb-2">Full access to all workspace features and settings</p>
                <ul class="text-sm text-secondary" style="list-style: disc; margin-left: var(--space-5);">
                    <li>Manage billing and subscription</li>
                    <li>Add/remove team members</li>
                    <li>Configure workspace settings</li>
                    <li>Access all meetings and recordings</li>
                </ul>
            </div>

            <div style="padding: var(--space-4); border: 1px solid var(--color-border); border-radius: var(--radius-lg);">
                <h3 class="font-semibold mb-2">Admin</h3>
                <p class="text-sm text-secondary mb-2">Manage team and meetings, but cannot modify billing</p>
                <ul class="text-sm text-secondary" style="list-style: disc; margin-left: var(--space-5);">
                    <li>Add/remove team members</li>
                    <li>Configure workspace settings</li>
                    <li>Access all meetings and recordings</li>
                    <li>Manage integrations</li>
                </ul>
            </div>

            <div style="padding: var(--space-4); border: 1px solid var(--color-border); border-radius: var(--radius-lg);">
                <h3 class="font-semibold mb-2">Member</h3>
                <p class="text-sm text-secondary mb-2">Create and manage own meetings</p>
                <ul class="text-sm text-secondary" style="list-style: disc; margin-left: var(--space-5);">
                    <li>Create and record meetings</li>
                    <li>Access own meetings and shared meetings</li>
                    <li>Generate transcripts and summaries</li>
                </ul>
            </div>

            <div style="padding: var(--space-4); border: 1px solid var(--color-border); border-radius: var(--radius-lg);">
                <h3 class="font-semibold mb-2">Viewer</h3>
                <p class="text-sm text-secondary mb-2">View-only access to shared meetings</p>
                <ul class="text-sm text-secondary" style="list-style: disc; margin-left: var(--space-5);">
                    <li>View shared meetings and transcripts</li>
                    <li>Download shared recordings</li>
                    <li>Cannot create or edit meetings</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="settings-card">
        <h2 class="settings-card-title">Usage & Analytics</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-4); margin-bottom: var(--space-6);">
            <div style="padding: var(--space-4); background: linear-gradient(135deg, var(--color-primary) 0%, #9333ea 100%); border-radius: var(--radius-lg); color: white;">
                <p class="text-sm opacity-90 mb-1">Total Meetings</p>
                <p class="text-3xl font-bold" data-stat="meetings">{{ workspace_meetings_count or 0 }}</p>
                <p class="text-xs opacity-75 mt-1">All time</p>
            </div>

            <div style="padding: var(--space-4); background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: var(--radius-lg); color: white;">
                <p class="text-sm opacity-90 mb-1">Hours Recorded</p>
                <p class="text-3xl font-bold" data-stat="hours">{{ workspace_hours or 0 }}</p>
                <p class="text-xs opacity-75 mt-1">Estimated</p>
            </div>

            <div style="padding: var(--space-4); background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: var(--radius-lg); color: white;">
                <p class="text-sm opacity-90 mb-1">Team Members</p>
                <p class="text-3xl font-bold" data-stat="members">{{ workspace_members|length if workspace_members else 1 }}</p>
                <p class="text-xs opacity-75 mt-1">Active users</p>
            </div>

            <div style="padding: var(--space-4); background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: var(--radius-lg); color: white;">
                <p class="text-sm opacity-90 mb-1">Storage Used</p>
                <p class="text-3xl font-bold" data-stat="storage">-</p>
                <p class="text-xs opacity-75 mt-1">Available soon</p>
            </div>
        </div>
    </div>

    <div class="settings-card">
        <h2 class="settings-card-title">Billing & Subscription</h2>
        <div style="padding: var(--space-4); background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%); border: 1px solid var(--color-primary); border-radius: var(--radius-lg); margin-bottom: var(--space-4);">
            <div class="flex justify-between items-start mb-3">
                <div>
                    <h3 class="font-semibold text-lg">Professional Plan</h3>
                    <p class="text-sm text-secondary">Unlimited recordings, advanced AI features</p>
                </div>
                <button class="btn btn-sm btn-ghost" data-action="manage-billing">Manage Plan</button>
            </div>
            <div class="flex items-baseline gap-2">
                <span class="text-3xl font-bold">$49</span>
                <span class="text-secondary">/month</span>
                <span class="text-sm" style="color: var(--color-success); background: rgba(16, 185, 129, 0.1); padding: 2px 8px; border-radius: 4px;">Active</span>
            </div>
        </div>

        <div style="display: flex; flex-direction: column; gap: var(--space-3);">
            <div class="flex justify-between items-center">
                <span class="text-sm">Next billing date</span>
                <span class="text-sm font-medium">-</span>
            </div>
            <div class="flex justify-between items-center">
                <span class="text-sm">Payment method</span>
                <span class="text-sm font-medium">-</span>
            </div>
            <div style="padding-top: var(--space-3); border-top: 1px solid var(--color-border);">
                <button class="btn btn-ghost btn-sm" data-action="update-payment">Update Payment Method</button>
                <button class="btn btn-ghost btn-sm ml-2" data-action="view-billing-history">View Billing History</button>
            </div>
        </div>
    </div>

    <div class="settings-card" style="border-color: var(--color-error);">
        <h2 class="settings-card-title" style="color: var(--color-error); -webkit-text-fill-color: var(--color-error); background: none;">Danger Zone</h2>
        <div style="display: flex; flex-direction: column; gap: var(--space-5);">
            <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: var(--space-4); border-bottom: 1px solid var(--color-border);">
                <div>
                    <p class="font-medium">Transfer Ownership</p>
                    <p class="text-sm text-secondary">Transfer workspace ownership to another admin</p>
                </div>
                <button class="btn btn-sm btn-ghost" data-action="transfer-ownership">Transfer</button>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <p class="font-medium" style="color: var(--color-error);">Delete Workspace</p>
                    <p class="text-sm text-secondary">Permanently delete this workspace and all associated data</p>
                </div>
                <button class="btn btn-sm" style="background: var(--color-error); color: white;" data-action="delete-workspace">Delete Workspace</button>
            </div>
        </div>
    </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/csrf.js') }}"></script>
<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}
