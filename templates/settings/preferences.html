{% extends "base.html" %}

{% block title %}Preferences - Mina{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/toast-notifications.css') }}">
{% endblock %}

{% block content %}
<div class="container settings-container" data-user-id="{{ current_user.id }}" data-user-email="{{ current_user.email }}">
    <div class="settings-header">
        <h1 class="settings-title">Settings</h1>
        <p class="settings-subtitle">Manage your account and preferences</p>
    </div>

    <div class="settings-tabs">
        <nav class="settings-tabs-nav">
            <a href="{{ url_for('settings.preferences') }}" class="tab-link active">Preferences</a>
            <a href="{{ url_for('settings.integrations') }}" class="tab-link">Integrations</a>
            <a href="{{ url_for('settings.profile') }}" class="tab-link">Profile</a>
            <a href="{{ url_for('settings.workspace_management') }}" class="tab-link">Workspace</a>
        </nav>
    </div>

    <div class="settings-content">
        <div class="settings-card">
            <h2 class="settings-card-title">Notification Settings</h2>
            <form data-category="general">
                <div class="form-group">
                    <label class="form-checkbox-label">
                        <input type="checkbox" name="email_notifications" data-preference="general.email_notifications" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Email Notifications</p>
                            <p class="checkbox-description">Receive email updates about your meetings</p>
                        </div>
                    </label>
                    
                    <label class="form-checkbox-label">
                        <input type="checkbox" name="meeting_reminders" data-preference="general.notifications" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Meeting Reminders</p>
                            <p class="checkbox-description">Get reminders before scheduled meetings</p>
                        </div>
                    </label>
                    
                    <label class="form-checkbox-label">
                        <input type="checkbox" name="task_updates" data-preference="tasks.notification_reminders" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Task Updates</p>
                            <p class="checkbox-description">Notifications when tasks are updated</p>
                        </div>
                    </label>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="insight_notifications" data-preference="summary.auto_generate" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">AI Insights Ready</p>
                            <p class="checkbox-description">Notify when meeting summaries and action items are generated</p>
                        </div>
                    </label>
                </div>
                
                <div style="margin-top: var(--space-6);">
                    <button type="submit" class="btn btn-primary">Save Preferences</button>
                </div>
            </form>
        </div>

        <div class="settings-card">
            <h2 class="settings-card-title">Transcription Controls</h2>
            <form data-category="transcription">
                <div class="form-group">
                    <div>
                        <label class="form-label">Default Language</label>
                        <select name="language" data-preference="transcription.language" class="form-select">
                            <option value="auto">Auto-detect</option>
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="zh">Chinese</option>
                            <option value="ja">Japanese</option>
                            <option value="pt">Portuguese</option>
                        </select>
                    </div>

                    <div style="margin-top: var(--space-4);">
                        <label class="form-label">Transcription Quality</label>
                        <select name="quality" data-preference="transcription.quality" class="form-select">
                            <option value="high">High (more accurate, slower)</option>
                            <option value="standard">Standard (balanced)</option>
                            <option value="fast">Fast (less accurate, faster)</option>
                        </select>
                    </div>
                    
                    <label class="form-checkbox-label">
                        <input type="checkbox" name="speaker_detection" data-preference="transcription.speaker_detection" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Speaker Diarization</p>
                            <p class="checkbox-description">Automatically detect and label different speakers</p>
                        </div>
                    </label>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="profanity_filter" data-preference="transcription.profanity_filter" class="form-checkbox">
                        <div class="checkbox-content">
                            <p class="checkbox-title">Profanity Filter</p>
                            <p class="checkbox-description">Automatically filter profane language in transcripts</p>
                        </div>
                    </label>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="punctuation" data-preference="transcription.punctuation" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Auto Punctuation</p>
                            <p class="checkbox-description">Automatically add punctuation and capitalization</p>
                        </div>
                    </label>
                </div>
                <div style="margin-top: var(--space-6);">
                    <button type="submit" class="btn btn-primary">Save Transcription Settings</button>
                </div>
            </form>
        </div>

        <div class="settings-card">
            <h2 class="settings-card-title">Privacy & Compliance</h2>
            <form data-category="privacy">
                <div class="form-group">
                    <div>
                        <label class="form-label">Data Retention Period</label>
                        <select name="data_retention_days" data-preference="privacy.data_retention_days" class="form-select">
                            <option value="30">30 days</option>
                            <option value="90">90 days</option>
                            <option value="365">1 year</option>
                            <option value="0">Forever</option>
                        </select>
                        <p class="form-help">Recordings and transcripts will be automatically deleted after this period</p>
                    </div>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="recording_consent" data-preference="privacy.recording_consent" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Recording Consent</p>
                            <p class="checkbox-description">Always ask for consent before recording</p>
                        </div>
                    </label>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="encrypt_storage" data-preference="privacy.encrypt_storage" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Encrypted Storage</p>
                            <p class="checkbox-description">Encrypt all stored recordings and transcripts</p>
                        </div>
                    </label>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="anonymous_usage_stats" data-preference="privacy.anonymous_usage_stats" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Anonymous Usage Statistics</p>
                            <p class="checkbox-description">Help improve Mina by sharing anonymous usage data</p>
                        </div>
                    </label>
                </div>
                <div style="margin-top: var(--space-6);">
                    <button type="submit" class="btn btn-primary">Save Privacy Settings</button>
                </div>
            </form>
        </div>

        <div class="settings-card data-rights-card">
            <h2 class="settings-card-title">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
                Your Data Rights (GDPR)
            </h2>
            <p class="data-rights-intro">
                Under GDPR, you have the right to access, export, and delete your personal data. 
                We encrypt all your data and never sell it or use it to train AI models.
            </p>
            
            <div class="data-rights-actions">
                <div class="data-right-item">
                    <div class="data-right-info">
                        <h3>Export Your Data</h3>
                        <p>Download a complete copy of all your data including meetings, transcripts, tasks, and account information in a portable format.</p>
                    </div>
                    <button type="button" class="btn btn-secondary" id="export-data-btn">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                        Export All Data
                    </button>
                </div>
                
                <div class="data-right-item">
                    <div class="data-right-info">
                        <h3>Update Consent Preferences</h3>
                        <p>Manage your marketing email preferences and cookie consent settings.</p>
                    </div>
                    <button type="button" class="btn btn-secondary" id="manage-consent-btn">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        Manage Consent
                    </button>
                </div>
                
                <div class="data-right-item danger-zone">
                    <div class="data-right-info">
                        <h3>Delete Account</h3>
                        <p>Permanently delete your account and all associated data. This action cannot be undone and will delete all your meetings, transcripts, and tasks.</p>
                    </div>
                    <button type="button" class="btn btn-danger" id="delete-account-btn">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                        Delete My Account
                    </button>
                </div>
            </div>
        </div>

        <!-- Consent Management Modal -->
        <div id="consent-modal" class="modal" style="display: none;">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Manage Your Consent</h3>
                    <button type="button" class="modal-close" aria-label="Close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="consent-form">
                        <div class="form-group">
                            <label class="form-checkbox-label">
                                <input type="checkbox" name="marketing_consent" class="form-checkbox" id="marketing-consent-checkbox">
                                <div class="checkbox-content">
                                    <p class="checkbox-title">Marketing Emails</p>
                                    <p class="checkbox-description">Receive product updates, tips, and occasional promotional emails</p>
                                </div>
                            </label>
                            
                            <label class="form-checkbox-label">
                                <input type="checkbox" name="analytics_consent" class="form-checkbox" id="analytics-consent-checkbox">
                                <div class="checkbox-content">
                                    <p class="checkbox-title">Analytics & Performance</p>
                                    <p class="checkbox-description">Allow anonymous usage data to help improve Mina</p>
                                </div>
                            </label>
                        </div>
                        <p class="consent-note">You can change these preferences at any time. Essential cookies required for the service are always enabled.</p>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary modal-cancel">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-consent-btn">Save Preferences</button>
                </div>
            </div>
        </div>

        <!-- Delete Account Confirmation Modal -->
        <div id="delete-modal" class="modal" style="display: none;">
            <div class="modal-overlay"></div>
            <div class="modal-content modal-danger">
                <div class="modal-header">
                    <h3>Delete Your Account</h3>
                    <button type="button" class="modal-close" aria-label="Close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="delete-warning">
                        <svg width="48" height="48" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                        </svg>
                        <h4>This action is permanent</h4>
                        <p>Deleting your account will permanently remove:</p>
                        <ul>
                            <li>All your meeting recordings</li>
                            <li>All transcripts and AI-generated summaries</li>
                            <li>All tasks and action items</li>
                            <li>Your profile and preferences</li>
                        </ul>
                        <p><strong>This cannot be undone.</strong></p>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="delete-confirm-email">Type your email to confirm:</label>
                        <input type="email" id="delete-confirm-email" class="form-input" placeholder="{{ current_user.email }}">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary modal-cancel">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-btn" disabled>Delete My Account</button>
                </div>
            </div>
        </div>

        <div class="settings-card">
            <h2 class="settings-card-title">AI Insights Configuration</h2>
            <form data-category="summary">
                <div class="form-group">
                    <div>
                        <label class="form-label">Summary Detail Level</label>
                        <select name="default_level" data-preference="summary.default_level" class="form-select">
                            <option value="brief">Brief (key points only)</option>
                            <option value="standard">Standard (balanced)</option>
                            <option value="detailed">Detailed (comprehensive)</option>
                        </select>
                    </div>

                    <div style="margin-top: var(--space-4);">
                        <label class="form-label">Summary Style</label>
                        <select name="default_style" data-preference="summary.default_style" class="form-select">
                            <option value="executive">Executive summary</option>
                            <option value="technical">Technical details</option>
                            <option value="action">Action-focused</option>
                        </select>
                    </div>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="auto_generate" data-preference="summary.auto_generate" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Auto-generate Summaries</p>
                            <p class="checkbox-description">Automatically generate summaries after meetings end</p>
                        </div>
                    </label>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="include_actions" data-preference="summary.include_actions" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Include Action Items</p>
                            <p class="checkbox-description">Extract and include action items in summaries</p>
                        </div>
                    </label>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="include_decisions" data-preference="summary.include_decisions" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Auto-detect Decisions</p>
                            <p class="checkbox-description">Identify and highlight key decisions made during meetings</p>
                        </div>
                    </label>
                </div>
                <div style="margin-top: var(--space-6);">
                    <button type="submit" class="btn btn-primary">Save AI Settings</button>
                </div>
            </form>
        </div>

        <div class="settings-card">
            <h2 class="settings-card-title">Audio & Recording</h2>
            <form data-category="audio">
                <div class="form-group">
                    <div>
                        <label class="form-label">Audio Quality</label>
                        <select name="quality" data-preference="audio.quality" class="form-select">
                            <option value="high">High Quality (48kHz)</option>
                            <option value="standard">Standard (44.1kHz)</option>
                            <option value="low">Low Bandwidth (22kHz)</option>
                        </select>
                    </div>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="noise_reduction" data-preference="audio.noise_reduction" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Noise Reduction</p>
                            <p class="checkbox-description">Reduce background noise in recordings</p>
                        </div>
                    </label>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="echo_cancellation" data-preference="audio.echo_cancellation" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Echo Cancellation</p>
                            <p class="checkbox-description">Remove echo from recordings</p>
                        </div>
                    </label>
                    
                    <label class="form-checkbox-label">
                        <input type="checkbox" name="voice_activity_detection" data-preference="audio.voice_activity_detection" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Voice Activity Detection</p>
                            <p class="checkbox-description">Automatically detect when someone is speaking</p>
                        </div>
                    </label>
                </div>
                <div style="margin-top: var(--space-6);">
                    <button type="submit" class="btn btn-primary">Save Audio Settings</button>
                </div>
            </form>
        </div>

        <div class="settings-card">
            <h2 class="settings-card-title">Interface Settings</h2>
            <form data-category="ui">
                <div class="form-group">
                    <div>
                        <label class="form-label">Theme</label>
                        <select name="theme" data-preference="ui.theme" class="form-select">
                            <option value="dark">Dark</option>
                            <option value="light">Light</option>
                            <option value="system">System default</option>
                        </select>
                    </div>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="keyboard_shortcuts" data-preference="ui.keyboard_shortcuts" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Keyboard Shortcuts</p>
                            <p class="checkbox-description">Enable keyboard shortcuts for quick actions</p>
                        </div>
                    </label>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="animations" data-preference="ui.animations" class="form-checkbox" checked>
                        <div class="checkbox-content">
                            <p class="checkbox-title">Animations</p>
                            <p class="checkbox-description">Enable smooth animations and transitions</p>
                        </div>
                    </label>

                    <label class="form-checkbox-label">
                        <input type="checkbox" name="compact_mode" data-preference="ui.compact_mode" class="form-checkbox">
                        <div class="checkbox-content">
                            <p class="checkbox-title">Compact Mode</p>
                            <p class="checkbox-description">Show more content with reduced spacing</p>
                        </div>
                    </label>
                </div>
                <div style="margin-top: var(--space-6);">
                    <button type="submit" class="btn btn-primary">Save Interface Settings</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/csrf.js') }}"></script>
<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}
