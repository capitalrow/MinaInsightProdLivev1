{% extends "base.html" %}

{% block title %}User Management - Admin{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin-dashboard.css') }}">
<style>
.admin-users-workspace {
    width: clamp(320px, 98vw, 1400px);
    max-width: 100%;
    min-height: calc(100vh - 64px);
    margin: 0 auto;
    padding: var(--space-6) var(--space-4);
}

.users-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-6);
}

.users-header h1 {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--color-text-primary);
}

.users-table-container {
    background: rgba(30, 41, 59, 0.6);
    border: 1px solid rgba(148, 163, 184, 0.1);
    border-radius: var(--radius-xl);
    overflow: hidden;
}

.users-table {
    width: 100%;
    border-collapse: collapse;
}

.users-table th,
.users-table td {
    padding: var(--space-4);
    text-align: left;
    border-bottom: 1px solid rgba(148, 163, 184, 0.08);
}

.users-table th {
    font-size: var(--font-size-xs);
    font-weight: 500;
    color: var(--color-text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    background: rgba(15, 23, 42, 0.5);
}

.users-table td {
    color: var(--color-text-secondary);
}

.users-table tr:hover {
    background: rgba(99, 102, 241, 0.05);
}

.user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: var(--font-size-sm);
}

.role-badge {
    display: inline-flex;
    padding: 4px 10px;
    border-radius: var(--radius-full);
    font-size: var(--font-size-xs);
    font-weight: 500;
}

.role-badge.owner {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
}

.role-badge.admin {
    background: rgba(139, 92, 246, 0.1);
    color: #8b5cf6;
}

.role-badge.user {
    background: rgba(107, 114, 128, 0.1);
    color: var(--color-text-secondary);
}

.pagination {
    display: flex;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-4);
}

.pagination-btn {
    padding: var(--space-2) var(--space-3);
    background: rgba(30, 41, 59, 0.6);
    border: 1px solid rgba(148, 163, 184, 0.1);
    border-radius: var(--radius-md);
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
}

.pagination-btn:hover {
    background: rgba(99, 102, 241, 0.1);
    border-color: rgba(99, 102, 241, 0.3);
}

.pagination-btn.active {
    background: var(--color-primary);
    color: white;
}

.pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
</style>
{% endblock %}

{% block content %}
<div class="admin-users-workspace">
    <header class="users-header">
        <div>
            <nav class="breadcrumb" style="color: var(--color-text-tertiary); font-size: var(--font-size-sm); margin-bottom: var(--space-2);">
                <a href="{{ url_for('admin.analytics_dashboard') }}" style="color: var(--color-primary); text-decoration: none;">Admin</a> / Users
            </nav>
            <h1>User Management</h1>
        </div>
        <div style="color: var(--color-text-tertiary);">
            {{ total_users }} users total
        </div>
    </header>

    <div class="users-table-container">
        <table class="users-table">
            <thead>
                <tr>
                    <th>User</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Last Login</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: var(--space-3);">
                            <div class="user-avatar">{{ user.username[0]|upper }}</div>
                            <div>
                                <div style="font-weight: 500; color: var(--color-text-primary);">{{ user.username }}</div>
                                <div style="font-size: var(--font-size-xs); color: var(--color-text-tertiary);">ID: {{ user.id }}</div>
                            </div>
                        </div>
                    </td>
                    <td>{{ user.email }}</td>
                    <td>
                        <span class="role-badge {{ user.role }}">{{ user.role|capitalize }}</span>
                    </td>
                    <td>
                        {% if user.active %}
                        <span style="color: #22c55e;">Active</span>
                        {% else %}
                        <span style="color: #ef4444;">Inactive</span>
                        {% endif %}
                    </td>
                    <td style="font-size: var(--font-size-sm);">
                        {{ user.created_at.strftime('%Y-%m-%d') if user.created_at else 'N/A' }}
                    </td>
                    <td style="font-size: var(--font-size-sm);">
                        {{ user.last_login.strftime('%Y-%m-%d %H:%M') if user.last_login else 'Never' }}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: var(--space-8); color: var(--color-text-tertiary);">
                        No users found.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        {% if total_pages > 1 %}
        <div class="pagination">
            <a href="?page={{ page - 1 }}" class="pagination-btn" {% if page == 1 %}disabled{% endif %}>
                Previous
            </a>
            {% for p in range(1, total_pages + 1) %}
            <a href="?page={{ p }}" class="pagination-btn {% if p == page %}active{% endif %}">
                {{ p }}
            </a>
            {% endfor %}
            <a href="?page={{ page + 1 }}" class="pagination-btn" {% if page == total_pages %}disabled{% endif %}>
                Next
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
